# ペンライトストライク

初音ミク「マジカルミライ2025」プログラミングコンテスト用の TextAlive App API を使用したコードです。
本プロジェクトでは、TextAlive App API を活用してリズムゲームを開発しました。
ゲーム開始時には、VOCALOID のインターフェースのように、ピアノロールに従って歌詞付きのノーツが複数生成されます。
プレイヤーはマウスを使ってノーツが落下する前にクリックしてください。
また、実際のライブのようにペンライトを振ってミクを応援できるような、没入感を高めたモードも用意しています。
高得点を目指して、ゲームと楽曲をお楽しみください！
English version of README is available [here](./README_en.md).

![penlight strike](./assets/welcome.png)

## 使用方法

ローカルサーバーを起動してプロジェクトを実行します。

```shell
# using http-server (recommended)
http-server -p 8000

# or using python server
python -m http.server 8000
```

`https://localhost:8000` にアクセスしてください。

## ナビゲーションシステム

最初に、ゲームタイトルとクレジットを記載したウェルカムページが表示されます。
この画面をクリックすると楽曲選択ページへと移行し、ゲームを開始することができます。

5曲のカルーセルシステムを実装し、楽曲のカバーをスムーズなアニメーションで表示します。
難易度の選択が可能で、ノーツの数、HP、判定のタイミングが変化します。
ゲームの遊び方を案内するチュートリアルページも実装しています。
ゲーム終了後は、最終スコアと達成状況を表示するリザルトページが表示されます。

![song selection](./assets/song-selection.png)

## ゲームプレイシステム

ゲーム中、TextAlive App API を使用して楽曲に合わせた歌詞付きのノーツが生成されます。
ノーツはVOCALOID ソフトのようなスタイルで、幅は発音時間に応じて変化します。
ノーツは楽曲のビートに合わせてクリックする必要があります。ミクの振っているペンライトを参考に操作してください。
赤いフェイクノーツには触れないよう注意してください。
複数回クリックする必要がある特別なノーツも登場します。
ペンライトモードが楽曲の選択画面で有効になっている場合、デバイスのカメラが起動して実際のペンライトがトラッキングされます。
このモードではペンライトを実際に振ってノーツを消すことができるため、より臨場感を味わえます。

![player](./assets/player.png)

## 実装

本プロジェクトでは、バニラ JavaScript、HTML、CSS によってすべての機能を実現しています。
歌詞、ビート、楽曲の同期といった基本的なユーティリティには TextAlive App API を使用しています。
ペンライトトラッキングのために、まず異なる条件下でペンライトを振る映像を収録し、ペンライトデータセットを構築しました。
次に、Tensorflow を使ってペンライトの先端キーポイント検出のための効率的なネットワークを学習させました。
CNN の U-Net 構造を用いてヒートマップを回帰することでペンライトの先端を特定します。
学習済みモデルは Tensorflow.js を用いてブラウザ上で動作するよう実装されています。
さらに、ペンライトの位置を滑らかかつ正確にトラッキングするため、等速度モデルに基づいたカルマンフィルタを使用して位置を補正し、FPS を向上させています。
このプロジェクトは、PC、スマートフォン、タブレットなどの最新の Web ブラウザで動作します。

## 開発者からのメッセージ

フロントエンド初心者の開発者として、これほど大規模なプロジェクトを一人で開発するのは今回が初めてです。「学びながら作る」という気持ちで、イラストや作曲、ロゴ制作、ゲームロジックの設計など、さまざまな面白いことに初挑戦しました。アイデアから少しずつ形になり、ついには実際に遊べるアプリへと完成していく様子を見て、思わず感動して涙が出ました。
イラストを提供してくださった百鬼伏羲さん、調教を手伝ってくださった杰克蔚博さん、翻訳を手伝ってくださったHaruさん、そして楽曲を提供してくださったプロデューサーの皆さん、カバーイラストを描いてくださった絵師の皆さんに心よりお礼申し上げます。
そして何より、Crypton Future Media様とTextAlive様に深く感謝いたします。このような貴重な機会をいただき、音楽も絵も描けないプログラマーの私でも、初音ミクに関わる創作に参加することができました。本当に誇りに思っています！
